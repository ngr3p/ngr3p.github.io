<h2>0x00 - Executive Summary</h2>
<p>
    Identity in Linux is a numerical abstraction. For a Red Team operator, manipulating the <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">/etc/passwd</code> structure and the <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">sudoers</code> policy engine represents one of the most direct paths to persistent administrative control. This report covers the tactical enumeration of system accounts and the mechanics of privilege elevation and persistence.
</p>
<p><strong>Impact Analysis:</strong> Successful exploitation allows for the subversion of the OS trust model, enabling an attacker to bypass authentication and maintain discrete, long-term administrative access.</p>

<h2>0x01 - Prerequisites & Tooling</h2>
<p>To follow this guide and replicate the lab environment, the following assets are required:</p>
<ul>
    <li><strong>Target Machine:</strong> Linux Environment (Debian-based recommended).</li>
    <li><strong>Initial Access:</strong> Local User Shell (Unprivileged).</li>
    <li><strong>Core Utilities:</strong> <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">cat</code>, <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">visudo</code>, <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">journalctl</code>, <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">id</code>.</li>
</ul>

<h2>0x02 - The Theory: Why it works</h2>
<p>
    Linux kernels do not recognize "usernames" during permission checks; they recognize <strong>UIDs (User Identifiers)</strong>. The root account is merely a label for <strong>UID 0</strong>. If any user entry in <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">/etc/passwd</code> is modified to reflect UID 0, that user inherits full kernel-level authority. 
</p>
<p>
    <strong>Red Team Insight:</strong> The transition from unprivileged to privileged states via <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">sudo</code> relies on the integrity of the <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">/etc/sudoers</code> file and the <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">visudo</code> parser.
</p>

<h2>0x03 - Step-by-Step Execution</h2>

<h3>Phase 1: Identity Enumeration</h3>
<p>The first objective is identifying human users and service accounts. Identifying accounts with interactive shells like <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">/bin/bash</code> or <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">/bin/sh</code> points to primary targets for lateral movement.</p>

<div class="terminal-block">
    <div class="terminal-header">
        <span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span>
        <span class="file-name">kali@lab-machine: ~</span>
    </div>
    <pre><code>cat /etc/passwd | grep -E 'sh$|bash$'</code></pre>
</div>

<div class="terminal-block">
    <div class="terminal-header">
        <span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span>
        <span class="file-name">output — passwd_db</span>
    </div>
    <pre><code>root:x:0:0:root:/root:/bin/bash
lab_user:x:1001:1001:,,,:/home/lab_user:/bin/bash
operator:x:1002:1002:,,,:/home/operator:/bin/bash</code></pre>
</div>

<h3>Phase 2: Account Creation and Persistence</h3>
<p>In a post-exploitation scenario, creating a persistent operator account provides a fallback mechanism. Promoting this user to the <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">sudo</code> group ensures full administrative reach.</p>

<div class="terminal-block">
    <div class="terminal-header">
        <span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span>
        <span class="file-name">kali@lab-machine: ~</span>
    </div>
    <pre><code>sudo adduser persistent_operator
sudo adduser persistent_operator sudo</code></pre>
</div>

<h3>Phase 3: Sudoers Policy Injection</h3>
<p>Using <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">visudo</code> allows for granular control. We trigger the editor to perform a direct entry insertion, granting <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">NOPASSWD</code> privileges for a full bypass.</p>

<div class="terminal-block">
    <div class="terminal-header">
        <span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span>
        <span class="file-name">kali@lab-machine: ~</span>
    </div>
    <pre><code>sudo visudo</code></pre>
</div>

<div class="terminal-block">
    <div class="terminal-header">
        <span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span>
        <span class="file-name">editor — /etc/sudoers</span>
    </div>
    <pre><code># User privilege specification
root                ALL=(ALL:ALL) ALL
persistent_operator ALL=(ALL:ALL) NOPASSWD:ALL</code></pre>
</div>

<h3>Phase 4: Real-time Surveillance</h3>
<p>Monitoring sudo execution in real-time is crucial to understand the system's audit trail and detect if other operators or admins are active.</p>

<div class="terminal-block">
    <div class="terminal-header">
        <span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span>
        <span class="file-name">kali@lab-machine: ~</span>
    </div>
    <pre><code>sudo journalctl -t sudo -f</code></pre>
</div>

<div class="terminal-block">
    <div class="terminal-header">
        <span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span>
        <span class="file-name">output — journal_stream</span>
    </div>
    <pre><code>Jan 20 01:31:53 lab-machine sudo[1842]: persistent_operator : TTY=pts/0 ; USER=root ; COMMAND=/usr/bin/cat /etc/shadow</code></pre>
</div>

<h2>0x04 - Offense Informs Defense</h2>
<p>To mitigate these vectors, security administrators should implement the following hardening steps:</p>
<ul>
    <li><strong>Auditd:</strong> Configure rules to monitor all writes to <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">/etc/passwd</code> and <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">/etc/sudoers</code>.</li>
    <li><strong>Shell Restriction:</strong> Ensure service accounts use <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">/usr/sbin/nologin</code>.</li>
    <li><strong>UID 0 Audit:</strong> Periodically run <code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">awk</code> to detect unauthorized UID 0 accounts.</li>
</ul>

<br>

<table style="width:100%; border-collapse: collapse; text-align: left; background-color: #1a1a1a; color: #fff; border: 1px solid #333; font-family: 'Courier New', Courier, monospace; font-size: 14px;">
    <thead>
        <tr style="background-color: #333; border-bottom: 2px solid #555;">
            <th style="padding: 15px; border: 1px solid #444;">Modern Command</th>
            <th style="padding: 15px; border: 1px solid #444;">Legacy Equivalent</th>
            <th style="padding: 15px; border: 1px solid #444;">Function</th>
        </tr>
    </thead>
    <tbody>
        <tr style="border-bottom: 1px solid #333;">
            <td style="padding: 12px; border: 1px solid #444;"><code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">adduser [user]</code></td>
            <td style="padding: 12px; border: 1px solid #444;"><code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">useradd -m -s /bin/bash</code></td>
            <td style="padding: 12px; border: 1px solid #444;">User provisioning</td>
        </tr>
        <tr style="border-bottom: 1px solid #333; background-color: #222;">
            <td style="padding: 12px; border: 1px solid #444;"><code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">deluser --remove-home</code></td>
            <td style="padding: 12px; border: 1px solid #444;"><code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">userdel -rf</code></td>
            <td style="padding: 12px; border: 1px solid #444;">Artifact cleanup</td>
        </tr>
        <tr style="border-bottom: 1px solid #333;">
            <td style="padding: 12px; border: 1px solid #444;"><code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">journalctl -t sudo -f</code></td>
            <td style="padding: 12px; border: 1px solid #444;"><code style="background-color: #1e1e1e; color: #d4d4d4; padding: 2px 5px; border-radius: 3px;">tail -f /var/log/auth.log</code></td>
            <td style="padding: 12px; border: 1px solid #444;">Log streaming</td>
        </tr>
    </tbody>
</table>